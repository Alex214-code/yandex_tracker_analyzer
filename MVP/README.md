# Yandex.Tracker Analyzer

Скрипт для выгрузки данных из Yandex.Tracker и генерации детальных Excel-отчетов с аналитикой по статусам и времени работы.

## Возможности

- **Фильтрация по Проектам**: Выборка задач осуществляется строго по принадлежности к Проекту (поле `Project`), а не по Очереди, что исключает ошибки при смешанных очередях.
- **Помесячная аналитика**: Генерация отчетов за произвольный диапазон месяцев (например, с октября по ноябрь).
- **Анализ "Активного пула"**: Расчет задач, которые были "В работе" (были на начало месяца + пришли в работу - выполнены).
- **Иерархия задач**: Определение корневого раздела (контейнера) для каждой задачи.
- **История статусов**: Восстановление статуса задачи на 1-е число каждого месяца и фиксация дат переходов.

## Требования

- Python 3.8+
- Зависимости из `requirements.txt`

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте файл `.env`

3. Заполните `.env` своими данными:
```
YANDEX_CLIENT_ID=ваш_client_id
YANDEX_OAUTH_TOKEN=ваш_oauth_token
YANDEX_ORG_ID=ваш_org_id
```

## Использование

Основной скрипт: `comprehensive_tracker_analyzer.py`.

### Примеры запуска

1. **Отчет за один месяц (например, ноябрь 2025):**
```bash
python comprehensive_tracker_analyzer.py --start-year 2025 --start-month 11 --end-year 2025 --end-month 11
```

2. **Отчет за диапазон (октябрь - ноябрь 2025):**
```bash
python comprehensive_tracker_analyzer.py --start-year 2025 --start-month 10 --end-year 2025 --end-month 11
```

3. **Справка по аргументам:**
```bash
python comprehensive_tracker_analyzer.py --help
```

## Параметры командной строки

- `--start-year`: Год начала периода (обязательно).
- `--start-month`: Месяц начала периода (обязательно).
- `--end-year`: Год окончания периода (по умолчанию равен году начала).
- `--end-month`: Месяц окончания периода (по умолчанию равен месяцу начала).

## Структура Excel отчета

Отчет сохраняется в файл вида `Tracker_Report_YYYY_MM-YYYY_MM.xlsx` и содержит следующие листы:

### 1. Все_Задачи
Полный реестр задач за каждый месяц периода.
- **Ключевые поля**: Проект, Раздел, Уровень вложенности, Исполнитель, Статусы и даты переходов.
- **Особенности**:
  - Если задача существовала в нескольких месяцах выборки, она будет продублирована для каждого месяца с актуальными статусами.
  - Статус `onHold` отображается как "Приостановлено".

### 2. Анализ_В_Работе
Сводная таблица движения задач через статус "В работе":
- **В работе (на начало)**: Сколько задач уже было в работе на 1-е число.
- **Пришло в работу**: Сколько задач перешло в этот статус в течение месяца.
- **Итого активных**: Сумма первых двух показателей (Пул задач).
- **Выполнено из пула**: Сколько из активных задач было закрыто.
- **Остаток в работе**: Активные минус выполненные.

### 3. Сводная_по_разделам
Статистика по корневым разделам (Контейнерам/Эпикам):
- Общее количество задач.
- Активность в статусе "В работе".
- Количество закрытых задач.

### 4. Статусы_на_1_число
Срез состояний задач на начало каждого месяца (сколько было Открыто, В работе, Закрыто и т.д.).

## Целевые проекты

Скрипт настроен на выгрузку задач из следующих проектов (список `TARGET_PROJECTS` в коде):

- НорНикель НОФ (Тех. Поддержка)
- УГМК Святогор (Тех. Поддержка)
- УГМК Гайский ГОК (Тех. Поддержка)
- РМК Томинский ГОК (Тех. Поддержка)

*(Список можно изменить непосредственно в файле скрипта)*.

## Логирование

Логи работы скрипта записываются в файл `tracker_analyzer.log`.
- Ротация логов: ежедневно.
- Хранение: 7 дней.

## Возможные ошибки

1. **401 Unauthorized**: Проверьте токен и ID организации в `.env`.
2. **Нет данных**: Убедитесь, что в указанный период в выбранных проектах были задачи.
3. **Кракозябры в консоли**: Скрипт использует UTF-8, убедитесь, что ваша консоль поддерживает его (для Windows: `chcp 65001`).
